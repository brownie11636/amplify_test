"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[106],{30106:function(t,e,o){o.r(e),o.d(e,{default:function(){return p}});var r=o(99534),n=o(29815),a=o(85893),s=(o(5152),o(99477)),i=o(67294),h=o(22974),c=o(91359);class l extends s.Loader{constructor(t){super(t)}load(t,e,o,r){const n=this,a=new s.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(o){try{e(n.parse(o))}catch(a){r?r(a):console.error(a),n.manager.itemError(t)}}),o,r)}parse(t){function e(t,e,o){for(let r=0,n=t.length;r<n;r++)if(t[r]!==e.getUint8(o+r))return!1;return!0}const o=function(t){if("string"===typeof t){const e=new Uint8Array(t.length);for(let o=0;o<t.length;o++)e[o]=255&t.charCodeAt(o);return e.buffer||e}return t}(t);return function(t){const o=new DataView(t);if(84+50*o.getUint32(80,!0)===o.byteLength)return!0;const r=[115,111,108,105,100];for(let n=0;n<5;n++)if(e(r,o,n))return!1;return!0}(o)?function(t){const e=new DataView(t),o=e.getUint32(80,!0);let r,n,a,i,h,c,l,u,g=!1;for(let s=0;s<70;s++)1129270351==e.getUint32(s,!1)&&82==e.getUint8(s+4)&&61==e.getUint8(s+5)&&(g=!0,i=new Float32Array(3*o*3),h=e.getUint8(s+6)/255,c=e.getUint8(s+7)/255,l=e.getUint8(s+8)/255,u=e.getUint8(s+9)/255);const f=new s.BufferGeometry,y=new Float32Array(3*o*3),M=new Float32Array(3*o*3);for(let s=0;s<o;s++){const t=84+50*s,o=e.getFloat32(t,!0),u=e.getFloat32(t+4,!0),f=e.getFloat32(t+8,!0);if(g){const o=e.getUint16(t+48,!0);0===(32768&o)?(r=(31&o)/31,n=(o>>5&31)/31,a=(o>>10&31)/31):(r=h,n=c,a=l)}for(let h=1;h<=3;h++){const c=t+12*h,l=3*s*3+3*(h-1);y[l]=e.getFloat32(c,!0),y[l+1]=e.getFloat32(c+4,!0),y[l+2]=e.getFloat32(c+8,!0),M[l]=o,M[l+1]=u,M[l+2]=f,g&&(i[l]=r,i[l+1]=n,i[l+2]=a)}}return f.setAttribute("position",new s.BufferAttribute(y,3)),f.setAttribute("normal",new s.BufferAttribute(M,3)),g&&(f.setAttribute("color",new s.BufferAttribute(i,3)),f.hasColors=!0,f.alpha=u),f}(o):function(t){const e=new s.BufferGeometry,o=/solid([\s\S]*?)endsolid/g,r=/facet([\s\S]*?)endfacet/g;let n=0;const a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+a+a+a,"g"),h=new RegExp("normal"+a+a+a,"g"),c=[],l=[],u=new s.Vector3;let g,f=0,y=0,M=0;for(;null!==(g=o.exec(t));){y=M;const t=g[0];for(;null!==(g=r.exec(t));){let t=0,e=0;const o=g[0];for(;null!==(g=h.exec(o));)u.x=parseFloat(g[1]),u.y=parseFloat(g[2]),u.z=parseFloat(g[3]),e++;for(;null!==(g=i.exec(o));)c.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),l.push(u.x,u.y,u.z),t++,M++;1!==e&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+n),3!==t&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+n),n++}const o=y,a=M-y;e.addGroup(o,a,f),f++}return e.setAttribute("position",new s.Float32BufferAttribute(c,3)),e.setAttribute("normal",new s.Float32BufferAttribute(l,3)),e}("string"!==typeof(r=t)?s.LoaderUtils.decodeText(new Uint8Array(r)):r);var r}}o(22006);function u(t,e){var o="unknown";if(function(t){if(null==t)return!1;return"function"===typeof t[Symbol.iterator]}(t.inputSources)){var r=!0,n=!1,a=void 0;try{for(var s,i=t.inputSources[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var h=s.value;h&&h.handedness&&(o=h.handedness),h.gamepad&&(e[o].prev={buttons:e[o].new.buttons.slice(),axes:e[o].new.axes.slice(0)},e[o].new={buttons:h.gamepad.buttons.map((function(t){return t.value})),axes:h.gamepad.axes.slice(0)})}}catch(c){n=!0,a=c}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}}return e}var g=o(51438),f=o(52951),y=function(){function t(e){if((0,g.Z)(this,t),5!==e.length)throw new Error("geometry array must have 5 entries");if(0!==e[3][1]||0!==e[3][2]||0!==e[4][0]||0!==e[4][2])throw new Error("geometry 3 and 4 must be one dimensional geo[3] = [a,0,0] geo[4] = [0,b,0]");this.V1_length_x_y=Math.sqrt(Math.pow(e[1][0],2)+Math.pow(e[1][1],2)),this.V4_length_x_y_z=Math.sqrt(Math.pow(e[4][0],2)+Math.pow(e[4][1],2)+Math.pow(e[4][2],2)),this.geometry=e,this.J_initial_absolute=[];for(var o=[0,0,0],r=0;r<e.length;r++)this.J_initial_absolute.push([o[0],o[1],o[2]]),o[0]+=e[r][0],o[1]+=e[r][1],o[2]+=e[r][2];this.R_corrected=[0,0,0,0,0,0],this.R_corrected[1]-=Math.PI/2,this.R_corrected[1]+=Math.atan2(e[1][0],e[1][1]),this.R_corrected[2]-=Math.PI/2,this.R_corrected[2]-=Math.atan2(e[2][1]+e[3][1],e[2][0]+e[3][0]),this.R_corrected[2]-=Math.atan2(e[1][0],e[1][1]),this.R_corrected[4]+=Math.atan2(e[4][1],e[4][0]),this.J_now=this.J_initial_absolute}return(0,f.Z)(t,[{key:"inverse",value:function(e,o,r,n,a,s){this.debug&&console.log(e,o,r,n,a,s);var i=Math.cos(n),h=Math.sin(n),c=Math.cos(a),l=Math.sin(a),u=Math.cos(s),g=Math.sin(s),f=[c*u,g*i+u*l*h,g*h-u*l*i],y=[this.R_corrected[0],this.R_corrected[1],this.R_corrected[2],this.R_corrected[3],this.R_corrected[4],this.R_corrected[5]],M=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];M[5][0]=e,M[5][1]=o,M[5][2]=r,M[4][0]=e-this.V4_length_x_y_z*f[0],M[4][1]=o-this.V4_length_x_y_z*f[1],M[4][2]=r-this.V4_length_x_y_z*f[2],y[0]+=Math.PI/2-Math.acos(this.J_initial_absolute[4][2]/t.length2(M[4][2],M[4][0])),y[0]+=Math.atan2(-M[4][2],M[4][0]),this.J_initial_absolute[4][2]>t.length2(M[4][2],M[4][0])&&this.debug&&console.log("out of reach"),M[1][0]=Math.cos(y[0])*this.geometry[0][0]+Math.sin(y[0])*this.geometry[0][2],M[1][1]=this.geometry[0][1],M[1][2]=-Math.sin(y[0])*this.geometry[0][0]+Math.cos(y[0])*this.geometry[0][2];var p=[];p[0]=Math.cos(y[0])*M[4][0]+-Math.sin(y[0])*M[4][2],p[1]=M[4][1],p[2]=Math.sin(y[0])*M[4][0]+Math.cos(y[0])*M[4][2];var d=Math.pow(p[0]-this.J_initial_absolute[1][0],2)+Math.pow(p[1]-this.J_initial_absolute[1][1],2),m=t.length2(this.geometry[2][0]+this.geometry[3][0],this.geometry[2][1]+this.geometry[3][1]);y[2]+=Math.acos((-d+Math.pow(m,2)+Math.pow(this.V1_length_x_y,2))/(2*m*this.V1_length_x_y));var _=Math.sqrt(d);y[1]+=Math.atan2(p[1]-this.J_initial_absolute[1][1],p[0]-this.J_initial_absolute[1][0]),y[1]+=Math.acos((+d-Math.pow(m,2)+Math.pow(this.V1_length_x_y,2))/(2*_*this.V1_length_x_y));var w=Math.cos(y[0]),v=Math.sin(y[0]),b=this.geometry[0][0],x=this.geometry[0][1],S=this.geometry[0][2],R=Math.cos(y[1]),A=Math.sin(y[1]),J=this.geometry[1][0],U=this.geometry[1][1],E=this.geometry[1][2],F=Math.cos(y[2]),I=Math.sin(y[2]),k=this.geometry[2][0],P=this.geometry[2][1],T=this.geometry[2][2];M[2][0]=w*b+v*S+w*R*J-w*A*U+v*E,M[2][1]=x+A*J+R*U,M[2][2]=-v*b+w*S-v*R*J+v*A*U+w*E,M[3][0]=w*b+v*S+w*R*J-w*A*U+v*E+w*R*F*k-w*A*I*k-w*A*F*P-w*R*I*P+v*T,M[3][1]=x+A*J+R*U+A*F*k+R*I*k+R*F*P-A*I*P,M[3][2]=-v*b+w*S-v*R*J+v*A*U+w*E-v*R*F*k+v*A*I*k+v*A*F*P+v*R*I*P+w*T;var V=[M[5][0]-M[4][0],M[5][1]-M[4][1],M[5][2]-M[4][2]],Z=[M[3][0]-M[4][0],M[3][1]-M[4][1],M[3][2]-M[4][2]],j=t.cross(V,Z),B=[10*Math.cos(y[0]+Math.PI/2),0,-10*Math.sin(y[0]+Math.PI/2)],C=t.cross(B,Z);y[3]=t.angleBetween(j,B,C);var L=t.cross(Z,j);y[4]+=t.angleBetween(V,Z,L);var D=[-g*c,u*i-g*l*h,u*h+g*l*i];return y[5]+=Math.PI/2,y[5]-=t.angleBetween(j,D,t.cross(D,f)),this.J_now=M,y}},{key:"calculateTCP",value:function(t,e,o,r,n,a,s){var i=this.calculateCoordinates(t,e,o,r,n,a);s[0]=i[5][0],s[1]=i[5][1],s[2]=i[5][2],s[3]=i[5][3],s[4]=i[5][4],s[5]=i[5][5]}},{key:"forward",value:function(t,e,o,r,n,a){var s=Math.cos(t),i=Math.sin(t),h=this.geometry[0][0],c=this.geometry[0][1],l=this.geometry[0][2],u=Math.cos(e),g=Math.sin(e),f=this.geometry[1][0],y=this.geometry[1][1],M=this.geometry[1][2],p=Math.cos(o),d=Math.sin(o),m=this.geometry[2][0],_=this.geometry[2][1],w=this.geometry[2][2],v=Math.cos(r),b=Math.sin(r),x=this.geometry[3][0],S=this.geometry[3][1],R=this.geometry[3][2],A=Math.cos(n),J=Math.sin(n),U=this.geometry[4][0],E=this.geometry[4][1],F=this.geometry[4][2],I=Math.cos(a),k=Math.sin(a),P=[[],[],[],[],[],[]];P[0][0]=0,P[0][1]=0,P[0][2]=0,P[1][0]=P[0][0]+s*h+i*l,P[1][1]=P[0][1]+c,P[1][2]=P[0][2]+-i*h+s*l,P[2][0]=P[1][0]+s*u*f-s*g*y+i*M,P[2][1]=P[1][1]+g*f+u*y,P[2][2]=P[1][2]-i*u*f+i*g*y+s*M,P[3][0]=P[2][0]+s*u*p*m-s*g*d*m-s*g*p*_-s*u*d*_+i*w,P[3][1]=P[2][1]+g*p*m+u*d*m+u*p*_-g*d*_,P[3][2]=P[2][2]-i*u*p*m+i*g*d*m+i*g*p*_+i*u*d*_+s*w,P[4][0]=P[3][0]+s*u*p*x-s*g*d*x-s*g*p*v*S-s*u*d*v*S+i*b*S+i*v*R+s*g*p*b*R+s*u*d*b*R,P[4][1]=P[3][1]+g*p*x+u*d*x+u*p*v*S-g*d*v*S-u*p*b*R+g*d*b*R,P[4][2]=P[3][2]-i*u*p*x+i*g*d*x+i*g*p*v*S+i*u*d*v*S+s*b*S+s*v*R-i*g*p*b*R-i*u*d*b*R,P[5][0]=P[4][0]+s*u*p*A*U-s*g*d*A*U-s*g*p*v*J*U-s*u*d*v*J*U+i*b*J*U-s*g*p*v*A*E-s*u*d*v*A*E+i*b*A*E-s*u*p*J*E+s*g*d*J*E+i*v*F+s*g*p*b*F+s*u*d*b*F,P[5][1]=P[4][1]+g*p*A*U+u*d*A*U+u*p*v*J*U-g*d*v*J*U+u*p*v*A*E-g*d*v*A*E-g*p*J*E-u*d*J*E-u*p*b*F+g*d*b*F,P[5][2]=P[4][2]-i*u*p*A*U+i*g*d*A*U+i*g*p*v*J*U+i*u*d*v*J*U+s*b*J*U+i*g*p*v*A*E+i*u*d*v*A*E+s*b*A*E+i*u*p*J*E-i*g*d*J*E+s*v*F-i*g*p*b*F-i*u*d*b*F;var T=[[s*g*p*v*A+s*u*d*v*A-i*b*A+s*u*p*J-s*g*d*J,-k*i*v-k*s*g*p*b-k*s*u*d*b+I*s*u*p*A-I*s*g*d*A-I*s*g*p*v*J-I*s*u*d*v*J+I*i*b*J,I*i*v+I*s*g*p*b+I*s*u*d*b+k*s*u*p*A-k*s*g*d*A-k*s*g*p*v*J-k*s*u*d*v*J+k*i*b*J],[-u*p*v*A+g*d*v*A+g*p*J+u*d*J,k*u*p*b-k*g*d*b+I*g*p*A+I*u*d*A+I*u*p*v*J-I*g*d*v*J,-I*u*p*b+I*g*d*b+k*g*p*A+k*u*d*A+k*u*p*v*J-k*g*d*v*J],[-i*g*p*v*A-i*u*d*v*A-s*b*A-i*u*p*J+i*g*d*J,-k*s*v+k*i*g*p*b+k*i*u*d*b-I*i*u*p*A+I*i*g*d*A+I*i*g*p*v*J+I*i*u*d*v*J+I*s*b*J,I*s*v-I*i*g*p*b-I*i*u*d*b-k*i*u*p*A+k*i*g*d*A+k*i*g*p*v*J+k*i*u*d*v*J+k*s*b*J]],V=0,Z=0,j=0;return 1!==T[2][0]||-1!==T[2][0]?(V=Math.PI+Math.asin(T[2][0]),Z=Math.atan2(T[2][1]/Math.cos(V),T[2][2]/Math.cos(V)),j=Math.atan2(T[1][0]/Math.cos(V),T[0][0]/Math.cos(V))):(j=0,-1===T[2][0]?(V=Math.PI/2,Z=j+Math.atan2(T[0][1],T[0][2])):(V=-Math.PI/2,Z=-j+Math.atan2(-T[0][1],-T[0][2]))),P[5][3]=Z,P[5][4]=V,P[5][5]=j,this.debug&&(console.log("+++++++++forward KINEMATICS++++++++++"),console.log("J0 X ".concat(P[0][0]," Y ").concat(P[0][1]," Z ").concat(P[0][2])),console.log("J1 X ".concat(P[1][0]," Y ").concat(P[1][1]," Z ").concat(P[1][2])),console.log("J2 X ".concat(P[2][0]," Y ").concat(P[2][1]," Z ").concat(P[2][2])),console.log("J4 X ".concat(P[4][0]," Y ").concat(P[4][1]," Z ").concat(P[4][2])),console.log("J5 X ".concat(P[5][0]," Y ").concat(P[5][1]," Z ").concat(P[5][2])),console.log("J5 A ".concat(P[5][3]," B ").concat(P[5][4]," C ").concat(P[5][5])),console.log("---------forward KINEMATICS----------".concat(P[1][1]))),P}}],[{key:"cross",value:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}},{key:"dot",value:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},{key:"angleBetween",value:function(e,o,r){var n=t.length3(t.cross(e,o));return Math.atan2(n,this.dot(e,o))*(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]>0?1:-1)}},{key:"length3",value:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2))}},{key:"length2",value:function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}}]),t}(),M=(s.MathUtils.RAD2DEG,s.MathUtils.DEG2RAD);function p(t){t.armRot,(0,r.Z)(t,["armRot"]);var e=(0,c.nH)(),o=(e.controllers,e.isPresenting,e.isHandTracking,e.player,e.session),l=(e.foveation,e.referenceSpace,[.12525,.16,.0368,.1117,.06478,.119]),g=[.1,.1,.05],f=new s.Vector3(g[0],g[1],g[2]);f.multiplyScalar(2.5);var p=new y([[0,l[0],0],[0,l[1],0],[l[2],0,0],[l[3],0,0],[0,-(l[4]+.04),0]]),m=(0,c.bc)("right"),_=[0,0,-90*M,0,-90*M,0],w=((0,i.useRef)(null),function(){var t=JSON.stringify({buttons:[0,0,0,0,0,0],axes:[0,0,0,0]});return{right:{new:JSON.parse(t),prev:JSON.parse(t)},left:{new:JSON.parse(t),prev:JSON.parse(t)}}}()),v=(0,i.useState)(0),b=(v[0],v[1],(0,i.useState)(0)),x=(b[0],b[1],(0,i.useState)(w)),S=x[0],R=x[1],A=(0,i.useState)(_),J=A[0],U=A[1];(0,h.A)((function(t,e){m&&(R(u(o,S)),U(function(t,e,o,r){var a,i=new s.Vector3;t.getWorldPosition(i),i.sub(o),i.multiplyScalar(e);var h=t.rotation,c=[i.x,i.y,i.z,h.x,h.y,h.z],l=(a=r).inverse.apply(a,(0,n.Z)(c));return console.log(l),l}(m,.4,f,p).map((function(t,e){return t+_[e]}))))}));for(var E=[],F=0;F<7;F++)0===F?E[F]={STLUrl:"/stls/base_binary.stl",pos:[0,0,0]}:(E.push({STLUrl:"/stls/arm".concat(F-1,"_binary.stl"),pos:[0,0,0]}),F>1&&(E[F].pos=[0,l[F-2],0]));for(var I=["/stls/base_binary.stl"],k=0;k<l.length;k++)I.push("/stls/arm".concat(k,"_binary.stl"));return(0,a.jsx)("group",{children:(0,a.jsx)(d,{info:E[0],rotation:[0,-90*s.MathUtils.DEG2RAD,0],children:(0,a.jsx)(d,{info:E[1],rotation:[0,J[0],0],children:(0,a.jsx)(d,{info:E[2],rotation:[J[1],0,0],children:(0,a.jsx)(d,{info:E[3],rotation:[J[2],0,0],children:(0,a.jsx)(d,{info:E[4],rotation:[0,J[3],0],children:(0,a.jsx)(d,{info:E[5],rotation:[J[4],0,0],children:(0,a.jsx)(d,{info:E[6],rotation:[0,J[5],0]})})})})})})})})}var d=function(t){var e=t.info,o=t.children,n=t.rotation,s=((0,r.Z)(t,["info","children","rotation"]),(0,h.D)(l,e.STLUrl)),c=(0,i.useRef)();return(0,a.jsxs)("mesh",{ref:c,position:e.pos,rotation:n,children:[(0,a.jsx)("primitive",{object:s,attach:"geometry"}),(0,a.jsx)("meshPhongMaterial",{color:"0xb0bef0",specular:"0x111111",shininess:"200",transparent:!0,opacity:"0.9"}),o]})}},29815:function(t,e,o){o.d(e,{Z:function(){return s}});var r=o(20943);var n=o(13375);var a=o(91566);function s(t){return function(t){if(Array.isArray(t))return(0,r.Z)(t)}(t)||(0,n.Z)(t)||(0,a.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}}]);