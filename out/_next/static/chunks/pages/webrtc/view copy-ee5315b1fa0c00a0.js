(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1577],{31994:function(e,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/view copy",function(){return o(63818)}])},63818:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return d}});var t=o(828),r=o(85893),c=o(67294),i=o(9828),s=o(44108),a=o(73538),l=o(78348),u=o(30767);function d(){var e=function(e){console.log("icecandidate event: ",e),e.candidate?I({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},n=function(e){console.log("createOffer() error: ",e)},o=function(e){console.log("sdp what?",e),v.current.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),I(e)},d=function(e){console.log("Failed to create session description: "+e.toString())},f=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),S.current=e.stream,h.current.srcObject=e.stream,console.log("remotevd@@@@@@",h.current.srcObject)},g=function(e){console.log("Remote stream removed. Event: ",e)},m=function(){j(!1),v.current.close(),v.current=null},v=(0,c.useRef)();console.log("adapter.browserDetails.browser?",u.Z.browserDetails.browser);var p=(0,c.useRef)(),h=(0,c.useRef)(),S=(0,c.useRef)({}),w=!1,y=(0,c.useRef)(),C=(0,c.useState)(!1),b=C[0],j=C[1],x=(0,c.useRef)(!1),R=(0,c.useState)([]),_=R[0],T=R[1],W=(0,c.useState)(!1),P=(W[0],W[1],(0,c.useRef)({})),O=(0,c.useState)([]),k=O[0],E=O[1],D={iceServers:[{urls:"turn:3.38.108.27",username:"usr",credential:"pass"}]},I=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o={from:i.W.id,to:n,message:e};console.log("Client sending message: ",o),i.W.emit("msg-v1",o)};(0,c.useEffect)((function(){T(_.concat({header:"ServiceList",filter:{}}));var e=new Array({header:"ServiceList",filter:{}});i.W.emit("q_service",e)}),[]),(0,c.useEffect)((function(){i.W.on("q_result",(function(e){var n=JSON.parse(e);if("ServiceList"===n.header){P.current=n.data;var o=k,r=!0,c=!1,i=void 0;try{for(var s,a=Object.entries(Object(P.current))[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var l=(0,t.Z)(s.value,2),u=l[0],d=l[1];console.log("list set up log","".concat(u,":").concat(d.sid)),o=o.concat("".concat(u,":").concat(d.sid))}}catch(f){c=!0,i=f}finally{try{r||null==a.return||a.return()}finally{if(c)throw i}}E(o)}})),i.W.on("created",(function(e){console.log("Created room "+e)})),i.W.on("full",(function(e){console.log("Room "+e+" is full")})),i.W.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!"),w=!0})),i.W.on("joined",(function(e){var n=P.current.find((function(e){return e.sid===y.current}));console.log("joined!"),"tsSensor"===n.description?console.log("location.href='SensorMonitor.html'"):"Streamer"===n.description&&(console.log("stremer"),console.log("Adding local stream."),I("connection request")),w=!0})),i.W.on("log",(function(e){console.log.apply(console,e)})),i.W.on("msg-v1",(function(e){var n=e.message;console.log("msg-v1 in!"),console.log("Client received message:",n);try{if("offer"===n.type)console.log("check : offer"),x.current||b||A(),v.current.setRemoteDescription(new RTCSessionDescription(n)),console.log("Sending answer to peer."),v.current.createAnswer().then(o,d);else if("answer"===n.type&&b)console.log("check : answer"),v.current.setRemoteDescription(new RTCSessionDescription(n));else if("candidate"===n.type&&b){console.log("check : candidate");var t=new RTCIceCandidate({sdpMLineIndex:n.label,candidate:n.candidate});v.current.addIceCandidate(t)}else"bye"===n&&b&&(console.log("check : bye"),console.log("Session terminated."),m(),x.current=!0)}catch(r){}}))}),[i.W]);var A=function(){console.log(">>>>>>> maybeStart() ",b,"localStream << \ubcc0\uc218 \uc8fc\uc11d\ucc98\ub9ac\ud568",w),!b&&w&&(console.log(">>>>>> creating peer connection"),function(){try{v.current=new RTCPeerConnection(D),v.current.onicecandidate=e,v.current.onaddstream=f,v.current.onremovestream=g,console.log("Created RTCPeerConnnection",v.current)}catch(n){return console.log("Failed to create PeerConnection, exception: "+n.message),void alert("Cannot create RTCPeerConnection object.")}}(),j(!0),console.log("isInitiator",x.current),x.current&&(console.log("Sending offer to peer"),v.current.createOffer(o,n)))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)(a.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,r.jsxs)(i.J.Provider,{value:i.W,children:[(0,r.jsxs)("div",{id:"videos",children:[(0,r.jsx)("video",{ref:p,id:"localVideo",autoPlay:!0,muted:!0,playsInline:!0}),(0,r.jsx)("video",{ref:h,id:"remoteVideo",autoPlay:!0,muted:!0,playsInline:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:function(){var e=P.current.find((function(e){return console.log(e),e.sid===y.current}));i.W.emit("Join_Service",e.sid)},children:"Start Streaming"}),(0,r.jsx)("button",{onClick:function(){console.log("Audio Toggle")},children:"My Audio On/Off"}),(0,r.jsx)("select",{onChange:function(e){console.log(e.target.value),y.current=e.target.value},value:y.current,children:k.map((function(e){return(0,r.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]})]}),(0,r.jsx)(l.Z,{})]})}}},function(e){e.O(0,[1664,5234,5126,2199,9774,2888,179],(function(){return n=31994,e(e.s=n);var n}));var n=e.O();_N_E=n}]);