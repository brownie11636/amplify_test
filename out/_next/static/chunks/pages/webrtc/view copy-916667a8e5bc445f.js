(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1577],{1994:function(e,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/view copy",function(){return o(3818)}])},3538:function(e,n,o){"use strict";var t=o(1438),r=o(2951),c=o(8029),i=o(5950),s=o(5893),a=o(7294),l=o(1664),u=o.n(l),d=function(e){(0,c.Z)(o,e);var n=(0,i.Z)(o);function o(){return(0,t.Z)(this,o),n.apply(this,arguments)}return(0,r.Z)(o,[{key:"render",value:function(){var e=this.props,n=e.pageTitle,o=e.homePageUrl,t=e.homePageText,r=e.activePageText,c=e.bgImgClass;return(0,s.jsxs)("div",{className:"page-title-area ".concat(c),children:[(0,s.jsx)("div",{className:"container",children:(0,s.jsxs)("div",{className:"page-title-content",children:[(0,s.jsx)("h2",{children:n}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:(0,s.jsx)(u(),{href:o,children:(0,s.jsx)("a",{children:t})})}),(0,s.jsx)("li",{children:r})]})]})}),(0,s.jsxs)("div",{className:"lines",children:[(0,s.jsx)("div",{className:"line"}),(0,s.jsx)("div",{className:"line"}),(0,s.jsx)("div",{className:"line"})]})]})}}]),o}(a.Component);n.Z=d},3818:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return d}});var t=o(828),r=o(5893),c=o(7294),i=o(9828),s=o(4108),a=o(3538),l=o(8348),u=o(767);function d(){var e=function(e){console.log("icecandidate event: ",e),e.candidate?E({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},n=function(e){console.log("createOffer() error: ",e)},o=function(e){console.log("sdp what?",e),v.current.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),E(e)},d=function(e){console.log("Failed to create session description: "+e.toString())},f=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),j.current=e.stream,p.current.srcObject=e.stream,console.log("remotevd@@@@@@",p.current.srcObject)},g=function(e){console.log("Remote stream removed. Event: ",e)},m=function(){b(!1),v.current.close(),v.current=null},v=(0,c.useRef)();console.log("adapter.browserDetails.browser?",u.Z.browserDetails.browser);var h=(0,c.useRef)(),p=(0,c.useRef)(),j=(0,c.useRef)({}),x=!1,S=(0,c.useRef)(),C=(0,c.useState)(!1),y=C[0],b=C[1],w=(0,c.useRef)(!1),R=(0,c.useState)([]),T=R[0],P=R[1],_=(0,c.useState)(!1),W=(_[0],_[1],(0,c.useRef)({})),N=(0,c.useState)([]),k=N[0],O=N[1],Z={iceServers:[{urls:"turn:3.38.108.27",username:"usr",credential:"pass"}]},E=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o={from:i.W.id,to:n,message:e};console.log("Client sending message: ",o),i.W.emit("msg-v1",o)};(0,c.useEffect)((function(){P(T.concat({header:"ServiceList",filter:{}}));var e=new Array({header:"ServiceList",filter:{}});i.W.emit("q_service",e)}),[]),(0,c.useEffect)((function(){i.W.on("q_result",(function(e){var n=JSON.parse(e);if("ServiceList"===n.header){W.current=n.data;var o=k,r=!0,c=!1,i=void 0;try{for(var s,a=Object.entries(Object(W.current))[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var l=(0,t.Z)(s.value,2),u=l[0],d=l[1];console.log("list set up log","".concat(u,":").concat(d.sid)),o=o.concat("".concat(u,":").concat(d.sid))}}catch(f){c=!0,i=f}finally{try{r||null==a.return||a.return()}finally{if(c)throw i}}O(o)}})),i.W.on("created",(function(e){console.log("Created room "+e)})),i.W.on("full",(function(e){console.log("Room "+e+" is full")})),i.W.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!"),x=!0})),i.W.on("joined",(function(e){var n=W.current.find((function(e){return e.sid===S.current}));console.log("joined!"),"tsSensor"===n.description?console.log("location.href='SensorMonitor.html'"):"Streamer"===n.description&&(console.log("stremer"),console.log("Adding local stream."),E("connection request")),x=!0})),i.W.on("log",(function(e){console.log.apply(console,e)})),i.W.on("msg-v1",(function(e){var n=e.message;console.log("msg-v1 in!"),console.log("Client received message:",n);try{if("offer"===n.type)console.log("check : offer"),w.current||y||I(),v.current.setRemoteDescription(new RTCSessionDescription(n)),console.log("Sending answer to peer."),v.current.createAnswer().then(o,d);else if("answer"===n.type&&y)console.log("check : answer"),v.current.setRemoteDescription(new RTCSessionDescription(n));else if("candidate"===n.type&&y){console.log("check : candidate");var t=new RTCIceCandidate({sdpMLineIndex:n.label,candidate:n.candidate});v.current.addIceCandidate(t)}else"bye"===n&&y&&(console.log("check : bye"),console.log("Session terminated."),m(),w.current=!0)}catch(r){}}))}),[i.W]);var I=function(){console.log(">>>>>>> maybeStart() ",y,"localStream << \ubcc0\uc218 \uc8fc\uc11d\ucc98\ub9ac\ud568",x),!y&&x&&(console.log(">>>>>> creating peer connection"),function(){try{v.current=new RTCPeerConnection(Z),v.current.onicecandidate=e,v.current.onaddstream=f,v.current.onremovestream=g,console.log("Created RTCPeerConnnection",v.current)}catch(n){return console.log("Failed to create PeerConnection, exception: "+n.message),void alert("Cannot create RTCPeerConnection object.")}}(),b(!0),console.log("isInitiator",w.current),w.current&&(console.log("Sending offer to peer"),v.current.createOffer(o,n)))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)(a.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,r.jsxs)(i.J.Provider,{value:i.W,children:[(0,r.jsxs)("div",{id:"videos",children:[(0,r.jsx)("video",{ref:h,id:"localVideo",autoPlay:!0,muted:!0,playsInline:!0}),(0,r.jsx)("video",{ref:p,id:"remoteVideo",autoPlay:!0,muted:!0,playsInline:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:function(){var e=W.current.find((function(e){return console.log(e),e.sid===S.current}));i.W.emit("Join_Service",e.sid)},children:"Start Streaming"}),(0,r.jsx)("button",{onClick:function(){console.log("Audio Toggle")},children:"My Audio On/Off"}),(0,r.jsx)("select",{onChange:function(e){console.log(e.target.value),S.current=e.target.value},value:S.current,children:k.map((function(e){return(0,r.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]})]}),(0,r.jsx)(l.Z,{})]})}},6894:function(e,n,o){"use strict";o.d(n,{d5:function(){return t}});var t="https://api.portal301.com"},9828:function(e,n,o){"use strict";o.d(n,{J:function(){return a},W:function(){return s}});var t=o(7294),r=o(6809),c=o.n(r),i=o(6894).d5,s=c()(i,{transports:["websocket"]}),a=(0,t.createContext)(s)},7020:function(){}},function(e){e.O(0,[1664,5234,5126,4569,9774,2888,179],(function(){return n=1994,e(e.s=n);var n}));var n=e.O();_N_E=n}]);