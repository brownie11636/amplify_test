(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1243],{1391:function(e,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/view",function(){return o(3471)}])},3471:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return f}});var t=o(5893),r=o(7294),i=o(6583),c=o(4119),s=o(50),a=o(6866),l=o(767);function u(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,t=new Array(n);o<n;o++)t[o]=e[o];return t}function d(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var o=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var t,r,i=[],c=!0,s=!1;try{for(o=o.call(e);!(c=(t=o.next()).done)&&(i.push(t.value),!n||i.length!==n);c=!0);}catch(a){s=!0,r=a}finally{try{c||null==o.return||o.return()}finally{if(s)throw r}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return u(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return u(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(){var e,n=function(e){console.log("icecandidate event: ",e),e.candidate?M({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},o=function(e){console.log("createOffer() error: ",e)},u=function(n){console.log("sdp what?",n),e.setLocalDescription(n),console.log("setLocalAndSendMessage sending message",n),M(n)},f=function(e){console.log("Failed to create session description: "+e.toString())},g=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),S((function(n){return e.stream})),h.current.srcObject=e.stream,console.log("remotevd@@@@@@",h.current.srcObject)},m=function(e){console.log("Remote stream removed. Event: ",e)},v=function(){x(!1),e.close(),e=null};(0,r.useRef)();console.log("adapter.browserDetails.browser?",l.Z.browserDetails.browser);var p=(0,r.useRef)(),h=(0,r.useRef)(),y=(0,r.useState)({}),S=(y[0],y[1]),b=!1,w=(0,r.useRef)(),j=(0,r.useState)(!1),C=j[0],x=j[1],R=(0,r.useState)(!1),_=R[0],T=R[1],W=(0,r.useState)([]),A=W[0],O=W[1],P=(0,r.useState)(!1),I=(P[0],P[1],(0,r.useRef)({})),E=(0,r.useState)([]),D=E[0],k=E[1],L={iceServers:[{urls:"turn:3.38.108.27",username:"usr",credential:"pass"}]},M=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o={from:i.W.id,to:n,message:e};console.log("Client sending message: ",o),i.W.emit("msg-v1",o)};(0,r.useEffect)((function(){O(A.concat({header:"ServiceList",filter:{}}));var e=new Array({header:"ServiceList",filter:{}});i.W.emit("q_service",e)}),[]),(0,r.useEffect)((function(){i.W.on("q_result",(function(e){console.log("query result:"+e);var n=JSON.parse(e);if(console.log(n.header),console.log(n.data),"ServiceList"===n.header){I.current=n.data;var o=D,t=!0,r=!1,i=void 0;try{for(var c,s=Object.entries(Object(I.current))[Symbol.iterator]();!(t=(c=s.next()).done);t=!0){var a=d(c.value,2),l=a[0],u=a[1];console.log("list set up log","".concat(l,":").concat(u.sid)),o=o.concat("".concat(l,":").concat(u.sid))}}catch(f){r=!0,i=f}finally{try{t||null==s.return||s.return()}finally{if(r)throw i}}k(o)}})),i.W.on("created",(function(e){console.log("Created room "+e)})),i.W.on("full",(function(e){console.log("Room "+e+" is full")})),i.W.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!"),b=!0})),i.W.on("joined",(function(e){console.log("join list",I.current,"selected",w.current);var n=I.current.find((function(e){return e.sid===w.current}));console.log("joined: "+n),"tsSensor"===n.description?console.log("location.href='SensorMonitor.html'"):"Streamer"===n.description&&(console.log("stremer"),console.log("Adding local stream."),M("connection request")),b=!0})),i.W.on("log",(function(e){console.log.apply(console,e)})),i.W.on("msg-v1",(function(n){var o=n.message;console.log("msg-v1 in!"),console.log("Client received message:",o);try{if("offer"===o.type)_||C||N(),e.setRemoteDescription(new RTCSessionDescription(o)),console.log("Sending answer to peer."),e.createAnswer().then(u,f);else if("answer"===o.type&&C)e.setRemoteDescription(new RTCSessionDescription(o));else if("candidate"===o.type&&C){var t=new RTCIceCandidate({sdpMLineIndex:o.label,candidate:o.candidate});e.addIceCandidate(t)}else"bye"===o&&C&&(console.log("Session terminated."),v(),T(!0))}catch(r){}}))}),[i.W]);var N=function(){console.log(">>>>>>> maybeStart() ",C,"localStream << \ubcc0\uc218 \uc8fc\uc11d\ucc98\ub9ac\ud568",b),!C&&b&&(console.log(">>>>>> creating peer connection"),function(){try{(e=new RTCPeerConnection(L)).onicecandidate=n,e.onaddstream=g,e.onremovestream=m,console.log("Created RTCPeerConnnection",e)}catch(o){return console.log("Failed to create PeerConnection, exception: "+o.message),void alert("Cannot create RTCPeerConnection object.")}}(),x(!0),console.log("isInitiator",_),_&&(console.log("Sending offer to peer"),e.createOffer(u,o)))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{}),(0,t.jsx)(s.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,t.jsxs)(i.J.Provider,{value:i.W,children:[(0,t.jsxs)("div",{id:"videos",children:[(0,t.jsx)("video",{ref:p,id:"localVideo",autoPlay:!0,muted:!0,playsInline:!0}),(0,t.jsx)("video",{ref:h,id:"remoteVideo",autoPlay:!0,muted:!0,playsInline:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:function(){var e=I.current.find((function(e){return e.sid===w.current}));console.log("selectedProfile? --\x3e ",e),i.W.emit("Join_Service",e.sid)},children:"Start Streaming"}),(0,t.jsx)("button",{onClick:function(){console.log("Audio Toggle")},children:"My Audio On/Off"}),(0,t.jsx)("select",{onChange:function(e){console.log(e.target.value),w.current=e.target.value},value:w.current,children:D.map((function(e){return(0,t.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]})]}),(0,t.jsx)(a.Z,{})]})}},6583:function(e,n,o){"use strict";o.d(n,{J:function(){return a},W:function(){return s}});var t=o(7294),r=o(6809),i=o.n(r),c=o(816).d5,s=i()(c,{transports:["websocket"]}),a=(0,t.createContext)(s)},7020:function(){}},function(e){e.O(0,[5637,6809,767,1309,4431,9774,2888,179],(function(){return n=1391,e(e.s=n);var n}));var n=e.O();_N_E=n}]);