(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1243],{1391:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/view",function(){return t(3471)}])},3471:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return d}});var o=t(5893),r=t(7294),i=t(6583),c=t(4119),a=t(50),s=t(6866);function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function u(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,r,i=[],c=!0,a=!1;try{for(t=t.call(e);!(c=(o=t.next()).done)&&(i.push(o.value),!n||i.length!==n);c=!0);}catch(s){a=!0,r=s}finally{try{c||null==t.return||t.return()}finally{if(a)throw r}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(){var e,n=function(e){console.log("icecandidate event: ",e),e.candidate?J({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},t=function(e){console.log("createOffer() error: ",e)},l=function(n){console.log("sdp what?",n),e.setLocalDescription(n),console.log("setLocalAndSendMessage sending message",n),J(n)},d=function(e){console.log("Failed to create session description: "+e.toString())},f=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),h((function(n){return e.stream})),p.current.srcObject=e.stream},g=function(e){console.log("Remote stream removed. Event: ",e)},m=function(){W(!1),e.close(),e=null},v=(0,r.useRef)(),p=(0,r.useRef)(),y=(0,r.useState)({}),h=(y[0],y[1]),S=!1,b=(0,r.useState)(["tttt","socketId: asdadadadads","grape","orange"]),C=b[0],j=b[1],w=(0,r.useState)(),x=w[0],I=w[1],_=(0,r.useState)(!1),T=_[0],W=_[1],A=(0,r.useState)(!1),P=A[0],R=A[1],k=(0,r.useState)([]),O=k[0],E=k[1],L=(0,r.useState)({}),M=L[0],D=L[1],q=(0,r.useState)(!1),N=(q[0],q[1],{iceServers:[{urls:"turn:3.38.108.27",username:"usr",credential:"pass"}]}),F=function(){console.log("Adding local stream."),J("connection request")},J=function(e,n){var t={from:i.W.id,to:n,message:e};console.log("Client sending message: ",t),i.W.emit("msg-v1",t)};(0,r.useEffect)((function(){E(O.concat({header:"ServiceList",filter:{}}));var e=new Array({header:"ServiceList",filter:{}});i.W.emit("q_service",e)}),[]),(0,r.useEffect)((function(){i.W.on("q_result",(function(e){console.log("query result:"+e);var n=!0,t=!1,o=void 0;try{for(var r,i=function(e,n){var t=n.value;if("ServiceList"===t.header){D((function(e){return t.data}));var o=t.data,r=!0,i=!1,c=void 0;try{for(var a,s=Object.entries(Object(o))[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=u(a.value,2),d=l[0],f=l[1];console.log("list set up log","".concat(d,": ").concat(f.socketId)),j(C.concat("".concat(d,":").concat(f.socketId)))}}catch(g){i=!0,c=g}finally{try{r||null==s.return||s.return()}finally{if(i)throw c}}}},c=e[Symbol.iterator]();!(n=(r=c.next()).done);n=!0)i(0,r)}catch(a){t=!0,o=a}finally{try{n||null==c.return||c.return()}finally{if(t)throw o}}})),i.W.on("created",(function(e){console.log("Created room "+e)})),i.W.on("full",(function(e){console.log("Room "+e+" is full")})),i.W.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!"),S=!0})),i.W.on("joined",(function(e){console.log("joined: "+e),S=!0})),i.W.on("log",(function(e){console.log.apply(console,e)})),i.W.on("msg-v1",(function(n){var t=n.message;console.log("msg-v1 in!"),console.log("Client received message:",t);try{if("offer"===t.type)P||T||Z(),e.setRemoteDescription(new RTCSessionDescription(t)),console.log("Sending answer to peer."),e.createAnswer().then(l,d);else if("answer"===t.type&&T)e.setRemoteDescription(new RTCSessionDescription(t));else if("candidate"===t.type&&T){var o=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});e.addIceCandidate(o)}else"bye"===t&&T&&(console.log("Session terminated."),m(),R(!0))}catch(r){}}))}),[i.W]);var Z=function(){console.log(">>>>>>> maybeStart() ",T,"localStream << \ubcc0\uc218 \uc8fc\uc11d\ucc98\ub9ac\ud568",S),!T&&S&&(console.log(">>>>>> creating peer connection"),function(){try{(e=new RTCPeerConnection(N)).onicecandidate=n,e.onaddstream=f,e.onremovestream=g,console.log("Created RTCPeerConnnection",e)}catch(t){return console.log("Failed to create PeerConnection, exception: "+t.message),void alert("Cannot create RTCPeerConnection object.")}}(),W(!0),console.log("isInitiator",P),P&&(console.log("Sending offer to peer"),e.createOffer(l,t)))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,{}),(0,o.jsx)(a.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,o.jsxs)(i.J.Provider,{value:i.W,children:[(0,o.jsxs)("div",{id:"videos",children:[(0,o.jsx)("video",{ref:v,id:"localVideo",autoPlay:!0,muted:!0,playsInline:!0}),(0,o.jsx)("video",{ref:p,id:"remoteVideo",autoPlay:!0,muted:!0,playsInline:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{onClick:function(){var e=M.find((function(e){return e.socketId===x}));console.log("selectedProfile? --\x3e ",e),i.W.emit("Join_Service",e),"tsSensor"===e.service.description?console.log("location.href='SensorMonitor.html'"):"Streamer"===e.service.description&&F()},children:"Start Streaming"}),(0,o.jsx)("button",{onClick:function(){console.log("Audio Toggle")},children:"My Audio On/Off"}),(0,o.jsx)("select",{onChange:function(e){I((function(n){return e.target.value}))},value:x,children:C.map((function(e){return(0,o.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]})]}),(0,o.jsx)(s.Z,{})]})}},6583:function(e,n,t){"use strict";t.d(n,{J:function(){return s},W:function(){return a}});var o=t(7294),r=t(6809),i=t.n(r),c=t(816).d5,a=i()(c,{transports:["websocket"]}),s=(0,o.createContext)(a)},7020:function(){}},function(e){e.O(0,[5637,6809,1309,4431,9774,2888,179],(function(){return n=1391,e(e.s=n);var n}));var n=e.O();_N_E=n}]);