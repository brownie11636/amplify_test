(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9796],{285:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/cast",function(){return r(8003)}])},8003:function(e,n,r){"use strict";r.r(n),r.d(n,{App:function(){return x}});var t=r(4051),o=r.n(t),c=r(5893),i=r(7294),a=r(6809),s=r.n(a),u=r(4119),l=r(50),f=r(6866),d=r(4422);function g(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function p(e,n,r,t,o,c,i){try{var a=e[c](i),s=a.value}catch(u){return void r(u)}a.done?n(s):Promise.resolve(s).then(t,o)}function v(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var c=e.apply(n,r);function i(e){p(c,t,o,i,a,"next",e)}function a(e){p(c,t,o,i,a,"throw",e)}i(void 0)}))}}function m(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function h(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){m(e,n,r[n])}))}return e}function b(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,c=[],i=!0,a=!1;try{for(r=r.call(e);!(i=(t=r.next()).done)&&(c.push(t.value),!n||c.length!==n);i=!0);}catch(s){a=!0,o=s}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return c}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return g(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},w=d.d5,x=function(){var e=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),g.current.srcObject=e.stream},n=(0,i.useRef)(),r=(0,i.useRef)(),t=(0,i.useRef)({}),a=(0,i.useRef)(),d=(0,i.useRef)(null),g=(0,i.useRef)(null),p=(0,i.useRef)(),x=(0,i.useRef)(),S=(0,i.useRef)(),k=(0,i.useState)([]),j=k[0],R=k[1],C=function(e,r){console.log("send message(emit msg-v1)",e.type,r);var t={from:n.current.id,to:r,message:e};n.current.emit("msg-v1",t)},T=function(){var e=v(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:t=e.sent,d.current&&(d.current.srcObject=t),t.getTracks().forEach((function(e){r.current&&r.current.addTrack(e,t)})),n.current.emit("Start_Service",{socketId:n.current.id,room:"room:"+n.current.id,type:"Device_1",description:"Streamer",contents:"jooonik"}),C("got user media",null),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),O=(function(){var e=v(o().mark((function e(){var t,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create offer"),t=S.current.find((function(e){return e.sid===x.current})),console.log(t),console.log(t),n.current.emit("Join_Service",t.sid),e.prev=5,e.next=8,r.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 8:return c=e.sent,e.next=11,r.current.setLocalDescription(new RTCSessionDescription(c));case 11:console.log(r.current.iceGatheringState),r.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},C(c,t.sid),a.current=t.sid,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(5),console.log("errrrrrrrrr"),console.error(e.t0);case 21:case"end":return e.stop()}}),e,null,[[5,17]])})))}(),function(){var e=v(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:return t=e.sent,e.next=6,r.current.setLocalDescription(new RTCSessionDescription(t));case 6:console.log(r.current.iceGatheringState),r.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},C(t,a.current),n.current.emit("offer",t),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("errrrrrrrrr"),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}()),_=function(e){console.log("Failed to create session description: "+e.toString())},D=function(){var e=v(o().mark((function e(c,i){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.current[i]=new RTCPeerConnection(y),r.current.onicecandidate=function(e){if(e.candidate){if(!n.current)return;console.log("onicecandidate"),C({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate},i)}},r.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},t.current=h({},t.current,m({},i,r.current)),e.next=7,t.current[i].setRemoteDescription(new RTCSessionDescription(c));case 7:console.log("answer set remote description success",t.current),t.current[i].createAnswer().then(function(){var e=v(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.current[i].setLocalDescription(n);case 2:console.log("setLocalAndSendMessage sending message",n),C(n,i);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(n,r){return e.apply(this,arguments)}}(),A=(0,i.useState)([]),P=A[0],E=A[1];(0,i.useEffect)((function(){E(P.concat({header:"ServiceList",filter:{}}));var t=new Array({header:"ServiceList",filter:{}});return n.current=s()(w,{transports:["websocket"]}),n.current.connected?console.log("connected"):console.log("not conn"),n.current.emit("q_service",t),r.current=new RTCPeerConnection(y),p.current={socketId:n.current.id,room:"room:"+n.current.id,type:"Device_1",description:"Streamer",contents:"jooonik"},n.current.on("all_users",(function(e){console.log("alluser",e.length,e)})),n.current.on("user-connected",(function(e){console.log('"user-connected"',e)})),n.current.on("getOffer",(function(e){console.log("get offer"),D(e)})),n.current.on("getAnswer",(function(n){console.log("get answer"),r.current&&(r.current.setRemoteDescription(new RTCSessionDescription(n)),r.current.onaddstream=e)})),n.current.on("getCandidate",function(){var e=v(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.current.addIceCandidate(new RTCIceCandidate(n));case 4:console.log("candidate add success");case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),n.current.on("joined",(function(e,n){O(),console.log("joined!")})),n.current.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!")})),n.current.on("q_result",(function(e){var n=JSON.parse(e);if("ServiceList"===n.header){S.current=n.data;var r=j,t=!0,o=!1,c=void 0;try{for(var i,a=Object.entries(Object(S.current))[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=b(i.value,2),u=s[0],l=s[1];r=r.concat("".concat(u,":").concat(l.sid))}}catch(f){o=!0,c=f}finally{try{t||null==a.return||a.return()}finally{if(o)throw c}}R(r)}})),n.current.on("msg-v1",function(){var n=v(o().mark((function n(t){var c;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("------------------msg-v1 ",t.message.type,"-------------------"),c=t.message,console.log("msg from",t.from),console.log("Client received message:",c),a.current=t.from,n.prev=5,"connection request"!==c){n.next=10;break}console.log("check : connection request"),n.next=23;break;case 10:if("offer"!==c.type){n.next=14;break}console.log("check : offer",c),D(c,t.from),n.next=23;break;case 14:if("answer"!==c.type){n.next=22;break}if(r.current){n.next=17;break}return n.abrupt("return");case 17:console.log("signalingStat",r.current.signalingState),"stable"!==r.current.signalingState&&(console.log("set the pcRef : ",r.current),r.current.setRemoteDescription(new RTCSessionDescription(c)),r.current.onaddstream=e),console.log("set the pcRef2 : ",r.current),n.next=23;break;case 22:"candidate"===c.type&&console.log("check : candi");case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(5),console.log("eeeeeeeeeeee",n.t0);case 28:case"end":return n.stop()}}),n,null,[[5,25]])})));return function(e){return n.apply(this,arguments)}}()),function(){n.current,r.current}}),[]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u.Z,{}),(0,c.jsx)(l.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("video",{style:{width:240,height:240,margin:5,backgroundColor:"black"},muted:!0,ref:d,autoPlay:!0}),(0,c.jsx)("button",{onClick:T,children:"Start Streaming"}),(0,c.jsx)("button",{onClick:function(){O(a.current),console.log(r.current.iceGatheringState)},children:"console debug"}),(0,c.jsx)("select",{onChange:function(e){console.log(e.target.value),x.current=e.target.value},value:x.current,children:j.map((function(e){return(0,c.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]}),(0,c.jsx)(f.Z,{})]})};n.default=x},4422:function(e,n,r){"use strict";r.d(n,{d5:function(){return t}});var t="https://api.portal301.com"},7020:function(){}},function(e){e.O(0,[5637,6809,1309,4431,9774,2888,179],(function(){return n=285,e(e.s=n);var n}));var n=e.O();_N_E=n}]);