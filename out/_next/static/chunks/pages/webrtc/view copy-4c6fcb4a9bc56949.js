(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1577],{1762:function(e,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/view copy",function(){return o(667)}])},667:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return f}});var t=o(5893),r=o(7294),c=o(4197),i=o(4119),s=o(50),a=o(6866),l=o(767);function u(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,t=new Array(n);o<n;o++)t[o]=e[o];return t}function d(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var o=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var t,r,c=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(t=o.next()).done)&&(c.push(t.value),!n||c.length!==n);i=!0);}catch(a){s=!0,r=a}finally{try{i||null==o.return||o.return()}finally{if(s)throw r}}return c}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return u(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return u(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(){var e=function(e){console.log("icecandidate event: ",e),e.candidate?E({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},n=function(e){console.log("createOffer() error: ",e)},o=function(e){console.log("sdp what?",e),v.current.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),E(e)},u=function(e){console.log("Failed to create session description: "+e.toString())},f=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),y.current=e.stream,h.current.srcObject=e.stream,console.log("remotevd@@@@@@",h.current.srcObject)},g=function(e){console.log("Remote stream removed. Event: ",e)},m=function(){C(!1),v.current.close(),v.current=null},v=(0,r.useRef)();console.log("adapter.browserDetails.browser?",l.Z.browserDetails.browser);var p=(0,r.useRef)(),h=(0,r.useRef)(),y=(0,r.useRef)({}),S=!1,b=(0,r.useRef)(),w=(0,r.useState)(!1),j=w[0],C=w[1],x=(0,r.useRef)(!1),R=(0,r.useState)([]),_=R[0],T=R[1],A=(0,r.useState)(!1),O=(A[0],A[1],(0,r.useRef)({})),W=(0,r.useState)([]),P=W[0],I=W[1],k={iceServers:[{urls:"turn:3.38.108.27",username:"usr",credential:"pass"}]},E=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o={from:c.W.id,to:n,message:e};console.log("Client sending message: ",o),c.W.emit("msg-v1",o)};(0,r.useEffect)((function(){T(_.concat({header:"ServiceList",filter:{}}));var e=new Array({header:"ServiceList",filter:{}});c.W.emit("q_service",e)}),[]),(0,r.useEffect)((function(){c.W.on("q_result",(function(e){var n=JSON.parse(e);if("ServiceList"===n.header){O.current=n.data;var o=P,t=!0,r=!1,c=void 0;try{for(var i,s=Object.entries(Object(O.current))[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=d(i.value,2),l=a[0],u=a[1];console.log("list set up log","".concat(l,":").concat(u.sid)),o=o.concat("".concat(l,":").concat(u.sid))}}catch(f){r=!0,c=f}finally{try{t||null==s.return||s.return()}finally{if(r)throw c}}I(o)}})),c.W.on("created",(function(e){console.log("Created room "+e)})),c.W.on("full",(function(e){console.log("Room "+e+" is full")})),c.W.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!"),S=!0})),c.W.on("joined",(function(e){var n=O.current.find((function(e){return e.sid===b.current}));console.log("joined!"),"tsSensor"===n.description?console.log("location.href='SensorMonitor.html'"):"Streamer"===n.description&&(console.log("stremer"),console.log("Adding local stream."),E("connection request")),S=!0})),c.W.on("log",(function(e){console.log.apply(console,e)})),c.W.on("msg-v1",(function(e){var n=e.message;console.log("msg-v1 in!"),console.log("Client received message:",n);try{if("offer"===n.type)console.log("check : offer"),x.current||j||D(),v.current.setRemoteDescription(new RTCSessionDescription(n)),console.log("Sending answer to peer."),v.current.createAnswer().then(o,u);else if("answer"===n.type&&j)console.log("check : answer"),v.current.setRemoteDescription(new RTCSessionDescription(n));else if("candidate"===n.type&&j){console.log("check : candidate");var t=new RTCIceCandidate({sdpMLineIndex:n.label,candidate:n.candidate});v.current.addIceCandidate(t)}else"bye"===n&&j&&(console.log("check : bye"),console.log("Session terminated."),m(),x.current=!0)}catch(r){}}))}),[c.W]);var D=function(){console.log(">>>>>>> maybeStart() ",j,"localStream << \ubcc0\uc218 \uc8fc\uc11d\ucc98\ub9ac\ud568",S),!j&&S&&(console.log(">>>>>> creating peer connection"),function(){try{v.current=new RTCPeerConnection(k),v.current.onicecandidate=e,v.current.onaddstream=f,v.current.onremovestream=g,console.log("Created RTCPeerConnnection",v.current)}catch(n){return console.log("Failed to create PeerConnection, exception: "+n.message),void alert("Cannot create RTCPeerConnection object.")}}(),C(!0),console.log("isInitiator",x.current),x.current&&(console.log("Sending offer to peer"),v.current.createOffer(o,n)))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Z,{}),(0,t.jsx)(s.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,t.jsxs)(c.J.Provider,{value:c.W,children:[(0,t.jsxs)("div",{id:"videos",children:[(0,t.jsx)("video",{ref:p,id:"localVideo",autoPlay:!0,muted:!0,playsInline:!0}),(0,t.jsx)("video",{ref:h,id:"remoteVideo",autoPlay:!0,muted:!0,playsInline:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:function(){var e=O.current.find((function(e){return console.log(e),e.sid===b.current}));c.W.emit("Join_Service",e.sid)},children:"Start Streaming"}),(0,t.jsx)("button",{onClick:function(){console.log("Audio Toggle")},children:"My Audio On/Off"}),(0,t.jsx)("select",{onChange:function(e){console.log(e.target.value),b.current=e.target.value},value:b.current,children:P.map((function(e){return(0,t.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]})]}),(0,t.jsx)(a.Z,{})]})}}},function(e){e.O(0,[5637,6809,767,1309,2882,9774,2888,179],(function(){return n=1762,e(e.s=n);var n}));var n=e.O();_N_E=n}]);