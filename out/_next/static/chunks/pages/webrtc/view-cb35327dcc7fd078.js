(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1243],{6489:function(e,n){"use strict";n.Q=function(e,n){if("string"!==typeof e)throw new TypeError("argument str must be a string");for(var r={},o=n||{},c=e.split(";"),s=o.decode||t,a=0;a<c.length;a++){var u=c[a],l=u.indexOf("=");if(!(l<0)){var f=u.substring(0,l).trim();if(void 0==r[f]){var d=u.substring(l+1,u.length).trim();'"'===d[0]&&(d=d.slice(1,-1)),r[f]=i(d,s)}}}return r},n.q=function(e,n,t){var i=t||{},c=i.encode||r;if("function"!==typeof c)throw new TypeError("option encode is invalid");if(!o.test(e))throw new TypeError("argument name is invalid");var s=c(n);if(s&&!o.test(s))throw new TypeError("argument val is invalid");var a=e+"="+s;if(null!=i.maxAge){var u=i.maxAge-0;if(isNaN(u)||!isFinite(u))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(u)}if(i.domain){if(!o.test(i.domain))throw new TypeError("option domain is invalid");a+="; Domain="+i.domain}if(i.path){if(!o.test(i.path))throw new TypeError("option path is invalid");a+="; Path="+i.path}if(i.expires){if("function"!==typeof i.expires.toUTCString)throw new TypeError("option expires is invalid");a+="; Expires="+i.expires.toUTCString()}i.httpOnly&&(a+="; HttpOnly");i.secure&&(a+="; Secure");if(i.sameSite){switch("string"===typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return a};var t=decodeURIComponent,r=encodeURIComponent,o=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function i(e,n){try{return n(e)}catch(t){return e}}},2692:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/webrtc/view",function(){return t(371)}])},3538:function(e,n,t){"use strict";var r=t(1438),o=t(2951),i=t(8029),c=t(5950),s=t(5893),a=t(7294),u=t(1664),l=t.n(u),f=function(e){(0,i.Z)(t,e);var n=(0,c.Z)(t);function t(){return(0,r.Z)(this,t),n.apply(this,arguments)}return(0,o.Z)(t,[{key:"render",value:function(){var e=this.props,n=e.pageTitle,t=e.homePageUrl,r=e.homePageText,o=e.activePageText,i=e.bgImgClass;return(0,s.jsxs)("div",{className:"page-title-area ".concat(i),children:[(0,s.jsx)("div",{className:"container",children:(0,s.jsxs)("div",{className:"page-title-content",children:[(0,s.jsx)("h2",{children:n}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:(0,s.jsx)(l(),{href:t,children:(0,s.jsx)("a",{children:r})})}),(0,s.jsx)("li",{children:o})]})]})}),(0,s.jsxs)("div",{className:"lines",children:[(0,s.jsx)("div",{className:"line"}),(0,s.jsx)("div",{className:"line"}),(0,s.jsx)("div",{className:"line"})]})]})}}]),t}(a.Component);n.Z=f},371:function(e,n,t){"use strict";t.r(n),t.d(n,{App:function(){return y}});var r=t(7568),o=t(4924),i=t(6042),c=t(9396),s=t(828),a=t(4051),u=t.n(a),l=t(5893),f=t(7294),d=t(6809),p=t.n(d),g=t(4108),h=t(3538),v=t(8348),m=t(6894),w={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},x=m.d5,y=function(){var e=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),y.current.srcObject=e.stream},n=(0,f.useRef)(),t=(0,f.useRef)(),a=(0,f.useRef)({}),d=(0,f.useRef)(),m=(0,f.useRef)(null),y=(0,f.useRef)(null),S=(0,f.useRef)(),k=(0,f.useRef)(),b=(0,f.useRef)(),C=(0,f.useState)([]),j=C[0],O=C[1],T=function(e,t){console.log("send message(emit msg-v1)",e.type,t),console.log("send message(emit msg-v1)",e.type,t);var r={from:n.current.id,to:t,message:e};n.current.emit("msg-v1",r)},_=(function(){var e=(0,r.Z)(u().mark((function e(){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:r=e.sent,m.current&&(m.current.srcObject=r),r.getTracks().forEach((function(e){t.current&&t.current.addTrack(e,r)})),n.current.emit("Start_Service",{socketId:n.current.id,room:"room:"+n.current.id,type:"Device_1",description:"Streamer",contents:"jooonik"}),T("got user media",null),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))}(),function(){var e=(0,r.Z)(u().mark((function e(){var r,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create offer"),r=b.current.find((function(e){return e.sid===k.current})),console.log(r),n.current.emit("Join_Service",r.sid),e.prev=4,e.next=7,t.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 7:return o=e.sent,e.next=10,t.current.setLocalDescription(new RTCSessionDescription(o));case 10:console.log(t.current.iceGatheringState),t.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},T(o,r.sid),d.current=r.sid,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),console.log("errrrrrrrrr"),console.error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(){return e.apply(this,arguments)}}()),E=function(){var e=(0,r.Z)(u().mark((function e(){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:return r=e.sent,e.next=6,t.current.setLocalDescription(new RTCSessionDescription(r));case 6:console.log(t.current.iceGatheringState),t.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},T(r,d.current),n.current.emit("offer",r),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("errrrrrrrrr"),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),R=function(e){console.log("Failed to create session description: "+e.toString())},N=function(){var e=(0,r.Z)(u().mark((function e(s,l){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.current[l]=new RTCPeerConnection(w),t.current.onicecandidate=function(e){if(e.candidate){if(!n.current)return;console.log("onicecandidate"),T({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate},l)}},t.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},a.current=(0,c.Z)((0,i.Z)({},a.current),(0,o.Z)({},l,t.current)),e.next=7,a.current[l].setRemoteDescription(new RTCSessionDescription(s));case 7:console.log("answer set remote description success",a.current),a.current[l].createAnswer().then(function(){var e=(0,r.Z)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.current[l].setLocalDescription(n);case 2:console.log("setLocalAndSendMessage sending message",n),T(n,l);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),R),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(n,t){return e.apply(this,arguments)}}(),D=(0,f.useState)([]),Z=D[0],A=D[1];(0,f.useEffect)((function(){A(Z.concat({header:"ServiceList",filter:{}}));var o=new Array({header:"ServiceList",filter:{}});return n.current=p()(x,{transports:["websocket"]}),n.current.connected?console.log("connected"):console.log("not conn"),n.current.emit("q_service",o),t.current=new RTCPeerConnection(w),S.current={socketId:n.current.id,room:"room:"+n.current.id,type:"Device_1",description:"Streamer",contents:"jooonik"},n.current.on("all_users",(function(e){console.log("alluser",e.length,e)})),n.current.on("user-connected",(function(e){console.log('"user-connected"',e)})),n.current.on("getOffer",(function(e){console.log("get offer"),N(e)})),n.current.on("getAnswer",(function(n){console.log("get answer"),t.current&&(t.current.setRemoteDescription(new RTCSessionDescription(n)),t.current.onaddstream=e)})),n.current.on("getCandidate",function(){var e=(0,r.Z)(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.current.addIceCandidate(new RTCIceCandidate(n));case 4:console.log("candidate add success");case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),n.current.on("joined",(function(e,n){E(),console.log("joined!")})),n.current.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!")})),n.current.on("q_result",(function(e){var n=JSON.parse(e);if("ServiceList"===n.header){b.current=n.data;var t=j,r=!0,o=!1,i=void 0;try{for(var c,a=Object.entries(Object(b.current))[Symbol.iterator]();!(r=(c=a.next()).done);r=!0){var u=(0,s.Z)(c.value,2),l=u[0],f=u[1];t=t.concat("".concat(l,":").concat(f.sid))}}catch(d){o=!0,i=d}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}O(t)}})),n.current.on("msg-v1",function(){var n=(0,r.Z)(u().mark((function n(r){var o;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("------------------msg-v1 ",r.message.type,"-------------------"),o=r.message,console.log("msg from",r.from),console.log("Client received message:",o),d.current=r.from,n.prev=5,"connection request"!==o){n.next=10;break}console.log("check : connection request"),n.next=23;break;case 10:if("offer"!==o.type){n.next=14;break}console.log("check : offer",o),N(o,r.from),n.next=23;break;case 14:if("answer"!==o.type){n.next=22;break}if(t.current){n.next=17;break}return n.abrupt("return");case 17:console.log("signalingStat",t.current.signalingState),"stable"!==t.current.signalingState&&(console.log("set the pcRef : ",t.current),t.current.setRemoteDescription(new RTCSessionDescription(o)),t.current.onaddstream=e),console.log("set the pcRef2 : ",t.current),n.next=23;break;case 22:"candidate"===o.type&&console.log("check : candi");case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(5),console.log("eeeeeeeeeeee",n.t0);case 28:case"end":return n.stop()}}),n,null,[[5,25]])})));return function(e){return n.apply(this,arguments)}}()),function(){n.current,t.current}}),[]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.Z,{}),(0,l.jsx)(h.Z,{pageTitle:"Security & Surveillance",homePageUrl:"/",homePageText:"Home",activePageText:"Service Details",bgImgClass:"item-bg2"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("video",{id:"remotevideo",style:{width:240,height:240,margin:5,backgroundColor:"black"},ref:y,autoPlay:!0}),(0,l.jsx)("button",{onClick:_,children:"Join Streaming"}),(0,l.jsx)("button",{onClick:function(){E(d.current),console.log(t.current.iceGatheringState)},children:"console debug"}),(0,l.jsx)("select",{onChange:function(e){console.log(e.target.value),k.current=e.target.value},value:k.current,children:j.map((function(e){return(0,l.jsx)("option",{value:e.split(":")[1],children:e},e)}))})]}),(0,l.jsx)(v.Z,{})]})};n.default=y},6894:function(e,n,t){"use strict";t.d(n,{d5:function(){return r}});var r="https://api.portal301.com"},1163:function(e,n,t){e.exports=t(387)},461:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var r=t(7294),o=t(6489);function i(e,n){void 0===n&&(n={});var t=function(e){if(e&&"j"===e[0]&&":"===e[1])return e.substr(2);return e}(e);if(function(e,n){return"undefined"===typeof n&&(n=!e||"{"!==e[0]&&"["!==e[0]&&'"'!==e[0]),!n}(t,n.doNotParse))try{return JSON.parse(t)}catch(r){}return e}var c=function(){return c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},c.apply(this,arguments)},s=function(){function e(e,n){var t=this;this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.cookies=function(e,n){return"string"===typeof e?o.Q(e,n):"object"===typeof e&&null!==e?e:{}}(e,n),new Promise((function(){t.HAS_DOCUMENT_COOKIE="object"===typeof document&&"string"===typeof document.cookie})).catch((function(){}))}return e.prototype._updateBrowserValues=function(e){this.HAS_DOCUMENT_COOKIE&&(this.cookies=o.Q(document.cookie,e))},e.prototype._emitChange=function(e){for(var n=0;n<this.changeListeners.length;++n)this.changeListeners[n](e)},e.prototype.get=function(e,n,t){return void 0===n&&(n={}),this._updateBrowserValues(t),i(this.cookies[e],n)},e.prototype.getAll=function(e,n){void 0===e&&(e={}),this._updateBrowserValues(n);var t={};for(var r in this.cookies)t[r]=i(this.cookies[r],e);return t},e.prototype.set=function(e,n,t){var r;"object"===typeof n&&(n=JSON.stringify(n)),this.cookies=c(c({},this.cookies),((r={})[e]=n,r)),this.HAS_DOCUMENT_COOKIE&&(document.cookie=o.q(e,n,t)),this._emitChange({name:e,value:n,options:t})},e.prototype.remove=function(e,n){var t=n=c(c({},n),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=c({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=o.q(e,"",t)),this._emitChange({name:e,value:void 0,options:n})},e.prototype.addChangeListener=function(e){this.changeListeners.push(e)},e.prototype.removeChangeListener=function(e){var n=this.changeListeners.indexOf(e);n>=0&&this.changeListeners.splice(n,1)},e}(),a=r.createContext(new s),u=(a.Provider,a.Consumer,a);function l(e){var n=(0,r.useContext)(u);if(!n)throw new Error("Missing <CookiesProvider>");var t=n.getAll(),o=(0,r.useState)(t),i=o[0],c=o[1],s=(0,r.useRef)(i);return"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement&&(0,r.useLayoutEffect)((function(){function t(){var t=n.getAll();(function(e,n,t){if(!e)return!0;for(var r=0,o=e;r<o.length;r++){var i=o[r];if(n[i]!==t[i])return!0}return!1})(e||null,t,s.current)&&c(t),s.current=t}return n.addChangeListener(t),function(){n.removeChangeListener(t)}}),[n]),[i,(0,r.useMemo)((function(){return n.set.bind(n)}),[n]),(0,r.useMemo)((function(){return n.remove.bind(n)}),[n])]}},7020:function(){},7568:function(e,n,t){"use strict";function r(e,n,t,r,o,i,c){try{var s=e[i](c),a=s.value}catch(u){return void t(u)}s.done?n(a):Promise.resolve(a).then(r,o)}function o(e){return function(){var n=this,t=arguments;return new Promise((function(o,i){var c=e.apply(n,t);function s(e){r(c,o,i,s,a,"next",e)}function a(e){r(c,o,i,s,a,"throw",e)}s(void 0)}))}}t.d(n,{Z:function(){return o}})},9534:function(e,n,t){"use strict";function r(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}t.d(n,{Z:function(){return r}})}},function(e){e.O(0,[1664,5234,4569,9774,2888,179],(function(){return n=2692,e(e.s=n);var n}));var n=e.O();_N_E=n}]);