(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6328],{43356:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/monkey-eye/operate",function(){return t(73365)}])},73365:function(e,n,t){"use strict";t.r(n),t.d(n,{App:function(){return T},default:function(){return _}});var r=t(47568),c=t(14924),o=t(26042),s=t(69396),a=t(828),i=t(34051),l=t.n(i),u=t(85893),d=t(67294),g=t(86809),f=t.n(g),m=t(44108),h=t(73538),p=t(78348),v=(t(41664),t(5152)),x=t.n(v),b=x()((function(){return t.e(8043).then(t.bind(t,18043)).then((function(e){return e.Donut}))}),{loadableGenerated:{webpack:function(){return[18043]}},ssr:!1});function j(e){var n=(0,d.useState)(!1),t=(n[0],n[1]),r=(0,d.useState)(0),c=r[0],o=r[1];(0,d.useEffect)((function(){o(e.value),t(!0)}),[]);return(0,u.jsx)("div",{className:"single-knob",children:(0,u.jsx)(b,{diameter:150,min:0,max:100,step:1,value:c,theme:{donutColor:"white",bgrColor:"gray",maxedBgrColor:"red",centerColor:"#1c1945",centerFocusedColor:"#13112e",donutThickness:3},onValueChange:function(n){o(n),e.onChange(n),console.log("changed")},ariaLabelledBy:"my-label",children:(0,u.jsx)("label",{id:"my-label",children:e.label})})})}var w=x()((function(){return t.e(8043).then(t.bind(t,18043)).then((function(e){return e.Donut}))}),{loadableGenerated:{webpack:function(){return[18043]}},ssr:!1});function C(e){var n=(0,d.useState)(!1),t=(n[0],n[1]),r=(0,d.useState)(0),c=r[0],o=r[1];(0,d.useEffect)((function(){o(e.value),t(!0)}),[]);return(0,u.jsx)("div",{className:"single-knob-indicator",children:(0,u.jsx)(w,{diameter:80,min:0,max:100,step:1,value:c,theme:{donutColor:"yellow",bgrColor:"gray",maxedBgrColor:"red",centerColor:"#1c1945",centerFocusedColor:"#13112e",donutThickness:3},onValueChange:function(n){o(n),e.onChange(n),console.log("changed")},ariaLabelledBy:"my-label",children:(0,u.jsx)("label",{id:"my-label",children:e.label})})})}var k=function(e){var n=function(n){e.onChange(n),console.log("panel:",n)};return(0,u.jsxs)("section",{className:"services-area bg-f2f6f9 ptb-110",children:[(0,u.jsx)("div",{className:"control-area",children:(0,u.jsxs)("div",{className:"control-panel",children:[(0,u.jsx)("label",{className:"title",children:"Control Box"}),(0,u.jsx)("div",{className:"container",children:(0,u.jsxs)("div",{className:"row",children:[(0,u.jsx)("div",{className:"col-lg-8",children:(0,u.jsxs)("div",{className:"controller",children:[(0,u.jsx)("label",{className:"title",children:"Control"}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(j,{onChange:n,value:50,label:"height"})}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(j,{onChange:n,value:80,label:"length"})}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(j,{onChange:n,value:90,label:"theta0"})}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(j,{onChange:n,value:90,label:"theta1"})})]})}),(0,u.jsx)("div",{className:"col-lg-4",children:(0,u.jsxs)("div",{className:"indicator",children:[(0,u.jsx)("label",{className:"title",children:"indicator"}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(C,{onChange:n,value:50})}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(C,{onChange:n,value:50})}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(C,{onChange:n,value:50})}),(0,u.jsx)("div",{className:"knob-box",children:(0,u.jsx)(C,{onChange:n,value:50})})]})})]})})]})}),(0,u.jsx)("div",{className:"shape-img2",children:(0,u.jsx)("img",{src:"/images/shape/shape2.svg",alt:"image"})}),(0,u.jsx)("div",{className:"shape-img3",children:(0,u.jsx)("img",{src:"/images/shape/shape3.png",alt:"image"})}),(0,u.jsx)("div",{className:"shape-img4",children:(0,u.jsx)("img",{src:"/images/shape/shape4.svg",alt:"image"})}),(0,u.jsx)("div",{className:"shape-img5",children:(0,u.jsx)("img",{src:"/images/shape/shape5.svg",alt:"image"})}),(0,u.jsx)("div",{className:"shape-img3",children:(0,u.jsx)("img",{src:"/images/shape/shape3.png",alt:"image"})}),(0,u.jsx)("div",{className:"dot-shape1",children:(0,u.jsx)("img",{src:"/images/shape/dot1.png",alt:"image"})}),(0,u.jsx)("div",{className:"dot-shape2",children:(0,u.jsx)("img",{src:"/images/shape/dot3.png",alt:"image"})}),(0,u.jsx)("div",{className:"dot-shape2",children:(0,u.jsx)("img",{src:"/images/shape/dot4.png",alt:"image"})}),(0,u.jsx)("div",{className:"dot-shape2",children:(0,u.jsx)("img",{src:"/images/shape/dot5.png",alt:"image"})}),(0,u.jsx)("div",{className:"dot-shape2",children:(0,u.jsx)("img",{src:"/images/shape/dot6.png",alt:"image"})})]})},N=t(37762),S=t(96894),y={iceServers:[{urls:"turn:3.35.133.246",username:"user",credential:"pass"},{urls:"stun:stun.l.google.com:19302"}]},R=S.d5,T=function(){var e=function(e){console.log("Remote stream added. event.stream?>>>",e.stream),x.current.srcObject=e.stream},n=function(e){console.log("Remote stream removed. Event:",e)},t=(0,d.useRef)(),i=(0,d.useRef)(),g=(0,d.useRef)({}),v=(0,d.useRef)(),x=((0,d.useRef)(null),(0,d.useRef)(null)),b=(0,d.useRef)(),j=((0,d.useRef)(),(0,d.useRef)()),w=(0,d.useState)([]),C=w[0],S=w[1],T=(0,d.useState)([]),_=T[0],D=T[1],Z=(0,d.useState)({}),L=Z[0],E=Z[1],A=function(e,n){console.log("send message(emit msg-v1)",e,n);var r={from:t.current.id,to:n,message:e};t.current.emit("msg-v1",r)},P=function(){var e=(0,r.Z)(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n),t.current.emit("Join_Service",n.sid);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I=(function(){var e=(0,r.Z)(l().mark((function e(n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n),t.current.emit("Join_Service",n.sid),e.prev=2,e.next=5,i.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:return r=e.sent,e.next=8,i.current.setLocalDescription(new RTCSessionDescription(r));case 8:console.log(i.current.iceGatheringState),i.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},A(r,L.sid),v.current=L.sid,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))}(),function(){var e=(0,r.Z)(l().mark((function e(){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.current.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:return n=e.sent,e.next=6,i.current.setLocalDescription(new RTCSessionDescription(n));case 6:console.log(i.current.iceGatheringState),i.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},A(n,v.current),t.current.emit("offer",n),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}()),O=function(e){console.log("Failed to create session description: "+e.toString())},M=function(){var c=(0,r.Z)(l().mark((function c(o,s){return l().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,i.current=new RTCPeerConnection(y),i.current.onicecandidate=function(e){if(e.candidate){if(!t.current)return;console.log("onicecandidate"),A({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate},s)}else console.log("End of candidates")},i.onaddstream=e,i.onremovestream=n,c.next=7,i.current.setRemoteDescription(new RTCSessionDescription(o));case 7:console.log("answer set remote description success",i.current),console.log("sending answer to peer"),i.current.createAnswer().then(function(){var e=(0,r.Z)(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.current.setLocalDescription(n);case 2:console.log("setLocalAndSendMessage sending message",n),A(n,s);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O),c.next=15;break;case 12:c.prev=12,c.t0=c.catch(0),console.error(c.t0);case 15:case"end":return c.stop()}}),c,null,[[0,12]])})));return function(e,n){return c.apply(this,arguments)}}(),q=(function(){var e=(0,r.Z)(l().mark((function e(n,a){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,g.current[a]=new RTCPeerConnection(y),i.current.onicecandidate=function(e){if(e.candidate){if(!t.current)return;console.log("onicecandidate"),A({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate},a)}else console.log("End of candidates")},i.current.oniceconnectionstatechange=function(e){console.log("oniceconnectionstatechange : ",e.target.connectionState)},g.current=(0,s.Z)((0,o.Z)({},g.current),(0,c.Z)({},a,i.current)),e.next=7,g.current[a].setRemoteDescription(new RTCSessionDescription(n));case 7:console.log("answer set remote description success",g.current),g.current[a].createAnswer().then(function(){var e=(0,r.Z)(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.current[a].setLocalDescription(n);case 2:console.log("setLocalAndSendMessage sending message",n),A(n,a);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))}(),(0,d.useState)([])),B=q[0],G=q[1];(0,d.useEffect)((function(){G(B.concat({header:"ServiceList",filter:{}}));var n=new Array({header:"ServiceList",filter:{}});return t.current=f()(R,{transports:["websocket"]}),t.current.connected?console.log("connected"):console.log("not conn"),t.current.emit("q_service",n),i.current=new RTCPeerConnection(y),b.current={socketId:t.current.id,room:"room:"+t.current.id,type:"Device_1",description:"Streamer",contents:"jooonik"},t.current.on("all_users",(function(e){console.log("alluser",e.length,e)})),t.current.on("user-connected",(function(e){console.log('"user-connected"',e)})),t.current.on("getOffer",(function(e){console.log("get offer"),M(e)})),t.current.on("getAnswer",(function(n){console.log("get answer"),i.current&&(i.current.setRemoteDescription(new RTCSessionDescription(n)),i.current.onaddstream=e)})),t.current.on("getCandidate",function(){var e=(0,r.Z)(l().mark((function e(n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,i.current.addIceCandidate(new RTCIceCandidate(n));case 4:console.log("candidate add success");case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),t.current.on("joined",(function(e,n){A("connection request"),console.log("connection request")})),t.current.on("join",(function(e){console.log("Another peer made a request to join room "+e),console.log("This peer is the initiator of room "+e+"!")})),t.current.on("q_result",(function(e){var n=JSON.parse(e);if("ServiceList"===n.header){j.current=n.data,S(n.data);var t=_,r=!0,c=!1,o=void 0;try{for(var s,i=Object.entries(Object(j.current))[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var l=(0,a.Z)(s.value,2),u=l[0],d=l[1];t=t.concat("".concat(u,":").concat(d.sid))}}catch(g){c=!0,o=g}finally{try{r||null==i.return||i.return()}finally{if(c)throw o}}D(t)}})),t.current.on("msg-v1",function(){var n=(0,r.Z)(l().mark((function n(t){var r,c;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("------------------msg-v1 ",t.message.type,"-------------------"),r=t.message,console.log("msg from",t.from),console.log("Client received message:",r),v.current=t.from,n.prev=5,"connection request"!==r){n.next=10;break}console.log("check : connection request"),n.next=23;break;case 10:if("offer"!==r.type){n.next=14;break}console.log("check : offer",r),M(r,t.from),n.next=23;break;case 14:if("answer"!==r.type){n.next=22;break}if(i.current){n.next=17;break}return n.abrupt("return");case 17:console.log("signalingStat",i.current.signalingState),"stable"!==i.current.signalingState&&(console.log("set the pcRef : ",i.current),i.current.setRemoteDescription(new RTCSessionDescription(r)),i.current.onaddstream=e),console.log("set the pcRef2 : ",i.current),n.next=23;break;case 22:"candidate"===r.type&&(console.log("check : candi"),c=new RTCIceCandidate({sdpMLineIndex:r.label,candidate:r.candidate}),i.current.addIceCandidate(c));case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(5),console.log("error",n.t0);case 28:case"end":return n.stop()}}),n,null,[[5,25]])})));return function(e){return n.apply(this,arguments)}}()),t.current.on("log",(function(e){console.log(e)})),function(){t.current,i.current}}),[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(m.Z,{}),(0,u.jsx)(h.Z,{pageTitle:"Monkey Eye",homePageUrl:"/",homePageText:"Home",activePageText:"Teleoperation",bgImgClass:"item-bg2"}),(0,u.jsx)("div",{className:"base-frame bg-f2f6f9",children:(0,u.jsx)("div",{className:"container",children:(0,u.jsxs)("div",{className:"row",children:[(0,u.jsx)("div",{className:"col-lg-6 col-sm-8",children:(0,u.jsxs)("div",{className:"video-area",children:[(0,u.jsx)("video",{id:"remotevideo",style:{width:360,height:360,margin:5,backgroundColor:"gray"},ref:x,autoPlay:!0}),(0,u.jsx)("div",{children:(0,u.jsx)("button",{onClick:function(){I(v.current),console.log(i.current.iceGatheringState)},children:"console debug"})})]})}),(0,u.jsx)("div",{className:"col-lg-6 col-sm-8",children:(0,u.jsx)("div",{className:"service-list-area",children:(0,u.jsx)(N.Z,{profileList:C,onProfileSelect:function(e){E(e),P(e),console.log("Selected profile:",e)}})})})]})})}),(0,u.jsx)(k,{onChange:function(e){t.current.emit("msg-v1",e),console.log("operate:",e)}}),(0,u.jsx)(p.Z,{})]})},_=T},96894:function(e,n,t){"use strict";t.d(n,{Ki:function(){return c},d5:function(){return r}});var r="https://api.portal301.com/",c="https://13.209.14.100:3333"}},function(e){e.O(0,[1664,5234,1643,1700,9774,2888,179],(function(){return n=43356,e(e.s=n);var n}));var n=e.O();_N_E=n}]);